/*! For license information please see bundle.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(self,()=>(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw i}}}}function r(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function c(n,r,o,a){var c=r&&r.prototype instanceof u?r:u,f=Object.create(c.prototype);return i(f,"_invoke",function(n,r,o){var a,i,c,u=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return a=e,i=0,c=t,p.n=n,s}};function d(n,r){for(i=n,c=r,e=0;!l&&u&&!o&&e<f.length;e++){var o,a=f[e],d=p.p,b=a[2];n>3?(o=b===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=d&&((o=n<2&&d<a[1])?(i=0,p.v=r,p.n=a[1]):d<b&&(o=n<3||a[0]>r||r>b)&&(a[4]=n,a[5]=r,p.n=b,i=0))}if(o||n>1)return s;throw l=!0,r}return function(o,f,b){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,b),i=f,c=b;(e=i<2?t:c)||!l;){a||(i?i<3?(i>1&&(p.n=-1),d(i,c)):p.n=c:p.v=c);try{if(u=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(l=p.n<0)?c:n.call(r,p))!==s)break}catch(e){a=t,i=1,c=e}finally{u=1}}return{value:e,done:l}}}(n,o,a),!0),f}var s={};function u(){}function f(){}function l(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(i(e={},r,function(){return this}),e),d=l.prototype=u.prototype=Object.create(p);function b(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,i(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return f.prototype=l,i(d,"constructor",l),i(l,"constructor",f),f.displayName="GeneratorFunction",i(l,o,"GeneratorFunction"),i(d),i(d,o,"Generator"),i(d,r,function(){return this}),i(d,"toString",function(){return"[object Generator]"}),(a=function(){return{w:c,m:b}})()}function i(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}i=function(t,e,n,r){function a(e,n){i(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},i(t,e,n,r)}function c(t,e,n,r,o,a,i){try{var c=t[a](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(t){c(a,r,o,i,s,"next",t)}function s(t){c(a,r,o,i,s,"throw",t)}i(void 0)})}}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,f(r.key),r)}}function f(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function l(t){var e="function"==typeof Map?new Map:void 0;return l=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(p())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&d(o,n.prototype),o}(t,arguments,b(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)},l(t)}function p(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(p=function(){return!!t})()}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var h=document.createElement("template");h.innerHTML='\n  <style>\n    .qt-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; }\n    .qt-button {\n      flex: 1 0 30%; min-width: 120px; padding: 10px;\n      background: #007AA3; color: white; border: none;\n      border-radius: 6px; font-size: 14px; cursor: pointer;\n      transition: background 0.2s ease;\n    }\n    .qt-button:hover { background: #005F7A; }\n    .qt-button:disabled { background: #ccc; cursor: not-allowed; }\n    #status { font-size:12px;color:#666;margin-top:8px; }\n  </style>\n\n  <div>\n    <div class="qt-container" id="btns"></div>\n    <div id="status">Starting…</div>\n  </div>\n';var g=function(r){function o(){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=function(e,n,r){return n=b(n),function(e,n){if(n&&("object"==t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(e,p()?Reflect.construct(n,r||[],b(e).constructor):n.apply(e,r))}(this,o)).attachShadow({mode:"open"}),e.shadowRoot.appendChild(h.content.cloneNode(!0)),e.buttonsConfig=[],e.Desktop=null,e.logger=console,e._boundUpdateButtons=e.updateButtons.bind(e),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}(o,r),i=o,c=[{key:"connectedCallback",value:function(){try{var t=this.getAttribute("data-buttons");t&&(this.buttonsConfig=JSON.parse(t))}catch(t){console.warn("[QuickTransfers] Invalid data-buttons JSON",t),this.buttonsConfig=[]}this.renderButtons(),this.waitForDesktopThenInit()}},{key:"disconnectedCallback",value:function(){if(this.Desktop&&this.Desktop.agentContact&&this.Desktop.agentContact.removeEventListener)try{this.Desktop.agentContact.removeEventListener("eAgentContactUpdated",this._boundUpdateButtons),this.Desktop.agentContact.removeEventListener("eAgentContactStarted",this._boundUpdateButtons),this.Desktop.agentContact.removeEventListener("eAgentContactEnded",this._boundUpdateButtons)}catch(t){}}},{key:"renderButtons",value:function(){var t=this,e=this.shadowRoot.getElementById("btns");this.buttonsConfig&&0!==this.buttonsConfig.length?(e.innerHTML=this.buttonsConfig.map(function(e,n){return'<button class="qt-button transfer-btn" data-idx="'.concat(n,'" disabled>').concat(t.escapeHtml(e.label),"</button>")}).join(""),e.querySelectorAll(".transfer-btn").forEach(function(e){e.addEventListener("click",function(){var e=s(a().m(function e(n){var r,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=parseInt(n.currentTarget.getAttribute("data-idx"),10),o=t.buttonsConfig[r]&&t.buttonsConfig[r].dest){e.n=1;break}return alert("Destination not configured for this button."),e.a(2);case 1:return e.n=2,t.handleTransfer(o);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())})):e.innerHTML='<div style="color:#666">No buttons configured</div>'}},{key:"escapeHtml",value:function(){return String(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/[&<>"'`]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"}[t]})}},{key:"setStatus",value:function(t){var e=this.shadowRoot.getElementById("status");e&&(e.textContent=t)}},{key:"waitForDesktopThenInit",value:(g=s(a().m(function t(){var e,n,r=this;return a().w(function(t){for(;;)if(0===t.n)return e=Date.now(),this.setStatus("Waiting for Desktop SDK to be available..."),n=function(){var t=s(a().m(function t(o){var i,c;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!window||!window.Desktop){t.n=8;break}if(r.Desktop=window.Desktop,r.Desktop.logger&&r.Desktop.logger.createLogger)try{r.logger=r.Desktop.logger.createLogger("quick-transfers-widget")}catch(t){r.logger=console}else r.logger=console;if(t.p=1,!r.Desktop.config||"function"!=typeof r.Desktop.config.init){t.n=5;break}return t.p=2,t.n=3,r.Desktop.config.init();case 3:r.logger.info&&r.logger.info("[QuickTransfers] Desktop.config.init() called"),t.n=5;break;case 4:t.p=4,i=t.v,r.logger.warn&&r.logger.warn("[QuickTransfers] Desktop.config.init() threw:",i);case 5:r.Desktop.agentContact&&r.Desktop.agentContact.addEventListener&&(r.Desktop.agentContact.addEventListener("eAgentContactUpdated",r._boundUpdateButtons),r.Desktop.agentContact.addEventListener("eAgentContactStarted",r._boundUpdateButtons),r.Desktop.agentContact.addEventListener("eAgentContactEnded",r._boundUpdateButtons)),r.updateButtons(),r.setStatus("SDK initialized (Desktop object available)"),t.n=7;break;case 6:t.p=6,c=t.v,r.logger.error&&r.logger.error("[QuickTransfers] Error during Desktop init:",c),r.setStatus("SDK init encountered an error — check console");case 7:return t.a(2,o(!0));case 8:if(!(Date.now()-e>1e4)){t.n=9;break}return r.setStatus("SDK not available in this context (timed out)."),r.logger.warn&&r.logger.warn("[QuickTransfers] window.Desktop not found after timeout."),t.a(2,o(!1));case 9:setTimeout(function(){return n(o)},200);case 10:return t.a(2)}},t,null,[[2,4],[1,6]])}));return function(e){return t.apply(this,arguments)}}(),t.a(2,new Promise(function(t){return n(t)}))},t,this)})),function(){return g.apply(this,arguments)})},{key:"updateButtons",value:function(){var t=this,r=this.shadowRoot.querySelectorAll(".transfer-btn"),o=!1;try{if(this.Desktop&&this.Desktop.agentContact&&"function"==typeof this.Desktop.agentContact.getSelectedContact){var a=this.Desktop.agentContact.getSelectedContact();a&&"telephony"===a.mediaType&&(o=!0)}else if(this.Desktop&&this.Desktop.actions&&"function"==typeof this.Desktop.actions.getTaskMap)return void this.Desktop.actions.getTaskMap().then(function(a){if(a){var i,c=n(a);try{for(c.s();!(i=c.n()).done;){var s=e(i.value,2)[1];if(s&&"telephony"===s.mediaType){o=!0;break}}}catch(t){c.e(t)}finally{c.f()}r.forEach(function(t){return t.disabled=!o});var u=o?"Active call detected":"No active call";t.setStatus(u)}}).catch(function(){r.forEach(function(t){return t.disabled=!0}),t.setStatus("No active call")})}catch(t){console.warn("[QuickTransfers] updateButtons error",t)}r.forEach(function(t){return t.disabled=!o}),this.setStatus(o?"Active call detected":"No active call")}},{key:"getInteractionIdFromTaskMap",value:(l=s(a().m(function t(){var e,r,o,i,c,s,u;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,this.Desktop&&this.Desktop.actions&&"function"==typeof this.Desktop.actions.getTaskMap){t.n=1;break}return t.a(2,null);case 1:return t.n=2,this.Desktop.actions.getTaskMap();case 2:e=t.v,r=n(e),t.p=3,r.s();case 4:if((o=r.n()).done){t.n=6;break}if(i=o.value,!(c=i[1]&&i[1].interactionId)){t.n=5;break}return t.a(2,c);case 5:t.n=4;break;case 6:t.n=8;break;case 7:t.p=7,s=t.v,r.e(s);case 8:return t.p=8,r.f(),t.f(8);case 9:t.n=11;break;case 10:return t.p=10,u=t.v,this.logger.warn&&this.logger.warn("[QuickTransfers] getInteractionIdFromTaskMap failed",u),t.a(2,null);case 11:return t.a(2,null)}},t,this,[[3,7,8,9],[0,10]])})),function(){return l.apply(this,arguments)})},{key:"handleTransfer",value:(f=s(a().m(function t(e){var n,r,o,i,c;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,this.Desktop){t.n=1;break}throw new Error("Desktop SDK not available");case 1:if(n=null,r=null,this.Desktop.agentContact&&"function"==typeof this.Desktop.agentContact.getSelectedContact&&(n=this.Desktop.agentContact.getSelectedContact()),!n||!n.interactionId){t.n=2;break}r=n.interactionId,t.n=4;break;case 2:return t.n=3,this.getInteractionIdFromTaskMap();case 3:r=t.v;case 4:if(r){t.n=5;break}throw new Error("No active call found to transfer");case 5:if(o={interactionId:r,data:{destAgentId:e,mediaType:"telephony",destinationType:"DN"}},!this.Desktop.agentContact||"function"!=typeof this.Desktop.agentContact.blindTransfer){t.n=7;break}return t.n=6,this.Desktop.agentContact.blindTransfer(o);case 6:i=t.v,this.logger.info&&this.logger.info("[QuickTransfers] blindTransfer response",i),this.setStatus("Transfer attempted — check call state"),t.n=8;break;case 7:throw new Error("blindTransfer API not available on Desktop.agentContact");case 8:t.n=10;break;case 9:t.p=9,c=t.v,console.error("[QuickTransfers] Transfer failed",c),alert("Transfer failed: "+(c&&c.message?c.message:String(c))),this.setStatus("Transfer failed: "+(c&&c.message?c.message:"unknown"));case 10:return t.a(2)}},t,this,[[0,9]])})),function(t){return f.apply(this,arguments)})}],c&&u(i.prototype,c),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,c,f,l,g}(l(HTMLElement));return customElements.define("custom-widget",g),{}})());